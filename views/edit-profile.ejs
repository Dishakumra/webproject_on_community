<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
  <link rel="stylesheet" href="  https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<title>CQ</title>
<style media="screen">
  <% include partials/viewcss %>

.card-body
{
  padding-left: 17px;
  margin-top: 3px;
}
/* body{
margin: 0;
padding: 0;
line-height: 1.42857143;
background-color: #F1F1F1;
}

.d1{
overflow: visible;
background-color: #222D3C;
height: 70px;
width: auto;
display: block;
/* margin-top:60px;
    padding: 0px 15px;
}
.d1 a{
float: left;
color: #f2f2f2;
text-align: center;
padding-left: 20px;
padding-right: 50px;
text-decoration: none;
font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
font-size: 20px;
font-weight: bold;
}
.d1 span{
color: white;
}
.d1 div{
box-sizing: border-box;
}
.d2{
height: 100%;
width: 50px;;
position: fixed;
z-index: 1;
top: 60px;
left: 0;
background-color: #000000;
overflow-x: hidden;
transition: 0.5s;
}

.d2 a{
display: block;
padding: 11px 4px 11px 15px;
text-decoration: none;
color: #999999;
transition: 0.1s;
font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
font-size: 15px;
white-space: nowrap;
cursor: pointer;
}
.fa{
font-size: 21px;
padding-right: 10px;
}
.d2 a:hover{
color : #fff;
background-color: #111;
border-left : 2px solid;
border-left-color: red;
}
.active{
background-color: #337AB7;
}
.d2 img{
width: 60px;
height: 60px;
}
#act{
color: white;
}
.sadmin{
float: right;
padding: .2em .6em .3em;
font-size: 75%;
    font-weight: 700;
    line-height: 1;
border-radius: 4px;
}
.mainpage{
/* padding-top : 0px;
padding-left : opx;
}
img{
cursor: pointer;
    width: 40px;
    margin-left: -3px;
    margin-right: 10px;
margin-top: 10px;
    float: right;
    border-radius: 50%;
} */

.allSides
{
box-shadow: 0 0 30px rgba(0,0,0,0.6);
-moz-box-shadow: 0 0 30px rgba(0,0,0,0.6);
-webkit-box-shadow: 0 0 30px rgba(0,0,0,0.6);
-o-box-shadow: 0 0 30px rgba(0,0,0,0.6);
}
.main
{
width:50%;
border-color: black;
height:20px;
height: 95vh;
justify-content: center;
align-content: center;
align-items: center;
display: flex;
margin-top: 89px;
margin-left:300px;
}
#boxes
{
width:1000px;
}
#image
{

height:120px;
width:125px;
border:1px black;
background:white;
color:black;
overflow: visible;

}
table {
border-spacing: 5px;
}
th, td {
padding: 30px;
spacing: 20px;
text-align:center;
}
.textbox
 {
height:80px;
width:250px;
border:1px grey;
background:white;
color:black;
overflow: visible;

 }
 .head
 {

background-color: lightgray;
width:100%;
text-align: center;
height:40px;
font-size: 25px;
width:250px;
 }
 .content
 {

background-color: white;
width:100%;
text-align: center;
height:40px;
font-size: 20px;
width:250px;
position:absolute;
 }

  /* The Close Button */
 .close {
 	padding-left: 617px;
   color: #aaaaaa;
   float: right;
   font-size: 28px;
   font-weight: bold;
 }

 .close:hover,
 .close:focus
 {
   color: #000;
   text-decoration: none;
   cursor: pointer;
 }
 #btndiv
 {
 	width : 223px;
 }

 #yesbtn
 {
 	width : 96px;
height: 45px;
float : left;
background-color: #222D3C; /* Green */
border: none;
color: white;
padding: 10px 32px;
text-align: center;
text-decoration: none;
display: inline-block;
font-size: 16px;
margin: 4px 2px;
-webkit-transition-duration: 0.4s; /* Safari */
transition-duration: 0.4s;
cursor: pointer;
background-color: white;
color: black;
border: 2px solid #222D3C;
 }
 #yesbtn:hover
 {
background-color: #222D3C;
color: white;
 }
 #nobtn
 {
 	width : 96px;
height : 45px;
float : right;
background-color: #222D3C; /* Green */
border: none;
color: white;
padding: 10px 32px;
text-align: center;
text-decoration: none;
display: inline-block;
font-size: 16px;
margin: 4px 2px;
-webkit-transition-duration: 0.4s; /* Safari */
transition-duration: 0.4s;
cursor: pointer;
background-color: white;
color: black;
border: 2px solid #222D3C;
 }
 #nobtn:hover
 {
background-color: #222D3C;
color: white;
 }
 #syesbtn
 {
  width : 96px;
  height: 45px;
  float : left;
  background-color: #222D3C; /* Green */
  border: none;
  color: #5CB85C;
  padding: 10px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  -webkit-transition-duration: 0.4s; /* Safari */
  transition-duration: 0.4s;
  background-color: white;
  cursor: pointer;
  color: black;
  border: 2px solid #5CB85C;
 }
 #syesbtn:hover
 {
 	background-color: #5CB85C;
 	color: white;
 }
 #snobtn
 {
  width : 96px;
  height : 45px;
  float : right;
  background-color: #222D3C; /* Green */
  border: none;
  color: white;
  padding: 10px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  -webkit-transition-duration: 0.4s; /* Safari */
  transition-duration: 0.4s;
  cursor: pointer;
  background-color: white;
  color: black;
  border: 2px solid #D9534F;
 }
 #snobtn:hover
 {
 	background-color: #D9534F;
 	color: white;
 }

 .close2 {
 	padding-left: 617px;
   color: #aaaaaa;
   float: right;
   font-size: 28px;
   font-weight: bold;
 }

 .close2:hover,
 .close2:focus {
   color: #000;
   text-decoration: none;
   cursor: pointer;
 }
 .glyphicon-log-out
 {
   color : white;
   background-color:#222D3C;
   border : 0px;
 }
</style>
</head>
<body onload="display_details()">
  <% include partials/new-user %>

  <div class="container" style="margin-top : 40px;">
    <div style="margin-top:30px;">
      <div class="col-12" >
            <div class="card allSidesSoft" style="box-shadow: 0 3px 10px 0 rgba(115,143,147,.3);">
                <div class="card-body">
                  <div class="d-flex">

                      <form class="image-container" method="POST" enctype="multipart/form-data" action='/upload'>
                        <img src="<%= typeof filename !='undefined' ? filename: '' %>" style="width: 150px; height: 150px;box-shadow: 0 3px 10px 0 rgba(115,143,147,.3);" class="img-thumbnail allSidesSoft" src="  <%= typeof filename == 'undefined'?'logo.jpg':filename %>"


                          <div class="custom-file">
                              <input type="file" name="profilepic" class="custom-file-input" id="validatedCustomFile" required>
                              <label class="custom-file-label" for="validatedCustomFile">Choose file...</label>
                              <p class="red">
                                  <%= typeof message == 'undefined'?'':message %>
                              </p>
                          </div>
                          <br />
                          <button type="submit" class="btn btn-primary gap">Submit</button>
                      </form>
                      <div class="ml-auto">
                          <input type="button" class="btn btn-danger btn-sm d-none" id="btnDiscard" value="Discard Changes">
                      </div>
                  </div>

                  <br>
                  <form>
                    <div class="panel-group">
                      <!--Form panel-->
                      <div class="panel panel-default editUserPanel">
                        <div class="panel-heading">Basic Info</div>
                          <div class="panel-body">
                              <div class="form-group">
                                      <label>Email :</label>
                                      <input type="text" id="email" class="form-control" name="username" disabled="true">
                              </div>
                              <div class="form-group">
                                  <label>Name :</label>
                                  <input type="text" id="name1" class="form-control" name="fullname" autocomplete="off" required="">
                              </div>
                              <div class="form-group col-sm-5" style="padding:0">
                                  <label>DOB :</label>
                                  <input class="form-control dobDate" id="date" name="dob" placeholder="MM/DD/YYYY" type="text" autocomplete="off" required="">
                              </div>
                              <div class="form-group col-sm-5 col-sm-push-2" style="padding:0">
                                      <label>Gender :</label>
                                      <select name="gender" class="form-control" id="gender">
                                          <optgroup label="Select Gender">

                                          <option class="c1" value="male" selected="">Male</option>



                                          <option class="c1" value="female">Female</option>



                                          <option class="c1" value="transgender">Transgender</option>

                                      </optgroup>
                                      </select>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default editUserPanel">
                        <div class="panel-heading">Contact Info</div>
                          <div class="panel-body">
                            <div class="form-group">
                                    <label>Phone :</label>
                                    <input type="text" id="phoneno" class="form-control" name="phone" maxlength="10" required="">
                            </div>
                            <div class="form-group">
                                    <label>City :</label>
                                    <input type="text" id="city" class="form-control" name="city" required="">
                            </div>
                          </div>
                        </div>

                        <div class="panel panel-default editUserPanel">
                          <div class="panel-heading">Personal Info</div>
                            <div class="panel-body">

                              <div class="form-group">
                                <label>Interests :</label>
                                <div class="tag-conatiner-custom-div">
                                  <!-- <select id="interestsEditor" name="interests" class="form-control input-sm select2-multiple select2-hidden-accessible" style="width:100%" multiple="" tabindex="-1" aria-hidden="true">
                                    <!--Tags option appended here-->




                                  <!-- </select>-->
                                  <span class="select2 select2-container select2-container--bootstrap" dir="ltr" style="width: 100%;"><span class="selection"><span class="select2-selection select2-selection--multiple form-control input-sm" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="-1"><ul class="select2-selection_rendered"><li class="select2-search select2-search--inline"><input class="select2-search_field" type="search" tabindex="0" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" placeholder="Enter interests..." style="width: 100%;"></li></ul></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                                </div>
                              </div>

                              <div class="form-group">
                                      <label>Tell us a bit more about your journey:</label>
                                      <textarea type="text" class="form-control" name="aboutjourney"></textarea>
                              </div>

                              <div class="form-group">
                                      <label>What are your expectations from the communities?</label>
                                      <textarea type="text" class="form-control" name="comExpectations"></textarea>
                              </div>

                            </div>
                          </div>

                        <br>

                        <div class="form-group">

                                <a onclick=showalert() class="btn btn-warning pull-left btnEditForm" style="margin:1px">Change Password</a>

                                <a href="/home-inner" class="btn btn-danger pull-right btnEditForm" style="margin:1px">Cancel</a>
                                <input type="submit" class="btn btn-primary pull-right btnEditForm" id="updatebtn" style="margin:1px" value="Update">
                        </div>

                      </div>
                  </form>
                </div>
           </div>
        </div>
    </div>
  </div>
</body>
<script>
<% include partials/viewjs %>
function showalert()
{
  alert("Update your credentials first!");
}
var currentuser=window.location.href.substring(window.location.href.lastIndexOf('/') + 1).replace("-"," ");
var email=document.getElementById('email');
var user=document.getElementById('name1');
var dob=document.getElementById('date');
var gender=document.getElementById('gender');
var phoneno=document.getElementById('phoneno');
var city=document.getElementById('city');
var update=document.getElementById('updatebtn');
var photopath=document.getElementById('validatedCustomFile');
var xhttp=new XMLHttpRequest();
var users=[];
var usere=[];
function getpic()
{

	var xttp=new XMLHttpRequest();
	xttp.open("GET",'/getdata');
	xttp.setRequestHeader("Content-Type",'application/json');
	xttp.send();
	xttp.onreadystatechange=function()
	{
		if (this.readyState == 4 && this.status == 200) {
				usere=JSON.parse(this.responseText);
			var len=usere.length;
			var i=0;
					while(i<len)
					{
						var path=usere[i].photopath;


						 path="../"+path;
			 document.getElementById("barpic").src=path;
				i++;
			}
	}
}
}
function display_details()
{
  getpic();
  xhttp.open('GET','/getdata');
  xhttp.setRequestHeader("Content-Type", "application/json");
  xhttp.send();
  xhttp.onreadystatechange=function()
  {
    if (this.readyState == 4 && this.status == 200) {
      users=JSON.parse(this.responseText);
      var i=0;
      var len=users.length;
      console.log(len);
      while(i<len)
      {
        user.value=users[i].user;
        dob.value=users[i].dob;
        phoneno.value=users[i].phno;
        email.value=users[i].email;
        city.value=users[i].city;
        gender.value=users[i].gender;
         document.getElementById("barpic").src=users[i].photopath;
        i++;
      }
    }
  };
}


update.onclick=function()
{
  var xhttp=new XMLHttpRequest();
  xhttp.addEventListener("load",function() {
  if(xhttp.responseText=="UPDATED")
  {
    alert("PROFILE UPDATED SUCCESSFULLY");
    window.location=`/1/${currentuser}`;
  }
  });

  xhttp.open('POST','/update_profile');
  xhttp.setRequestHeader("Content-Type", "application/json");
  xhttp.send(JSON.stringify({'user':user.value,'email':email.value,'dob':dob.value,'phoneno':phoneno.value,'city':city.value,'gender':gender.value}));

}
</script>
</html>
